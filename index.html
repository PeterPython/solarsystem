<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solar System Model</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
// Surface pattern generator
function createPlanetTexture(detail, roughness, baseColor) {
    const canvas = document.createElement('canvas');
    canvas.width = 128;
    canvas.height = 128;
    const context = canvas.getContext('2d');

    // Fill with base color
    context.fillStyle = baseColor;
    context.fillRect(0, 0, canvas.width, canvas.height);

    // Add noise pattern
    for (let i = 0; i < detail; i++) {
        for (let x = 0; x < canvas.width; x++) {
            for (let y = 0; y < canvas.height; y++) {
                if (Math.random() > roughness) {
                    const shade = Math.random() * 0.1 - 0.05;
                    context.fillStyle = `rgba(0,0,0,${shade})`;
                    context.fillRect(x, y, 1, 1);
                }
            }
        }
    }

    const texture = new THREE.CanvasTexture(canvas);
    texture.wrapS = THREE.RepeatWrapping;
    texture.wrapT = THREE.RepeatWrapping;
    return texture;
}

// Create specialized textures for different types of bodies
function createGasGiantTexture(baseColor) {
    const canvas = document.createElement('canvas');
    canvas.width = 256;
    canvas.height = 256;
    const context = canvas.getContext('2d');

    // Base color
    context.fillStyle = baseColor;
    context.fillRect(0, 0, canvas.width, canvas.height);

    // Create bands
    const bands = 12;
    for (let i = 0; i < bands; i++) {
        const y = (i * canvas.height) / bands;
        const height = canvas.height / bands;
        if (i % 2 === 0) {
            context.fillStyle = `rgba(255,255,255,0.1)`;
        } else {
            context.fillStyle = `rgba(0,0,0,0.1)`;
        }
        context.fillRect(0, y, canvas.width, height);
    }

    // Add swirls
    for (let i = 0; i < 50; i++) {
        const x = Math.random() * canvas.width;
        const y = Math.random() * canvas.height;
        const radius = Math.random() * 20 + 10;
        context.beginPath();
        context.arc(x, y, radius, 0, Math.PI * 2);
        context.fillStyle = `rgba(255,255,255,0.05)`;
        context.fill();
    }

    const texture = new THREE.CanvasTexture(canvas);
    texture.wrapS = THREE.RepeatWrapping;
    texture.wrapT = THREE.RepeatWrapping;
    return texture;
}
</script>
    <style>
        body { margin: 0; overflow: hidden; background: #000; }
        #controls {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            font-family: Arial, sans-serif;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 5px;
        }
        .slider-container { margin: 10px 0; }
        input[type="range"] { width: 200px; }
        #planetInfo {
            position: absolute;
            top: 20px;
            right: 20px;
            color: white;
            font-family: Arial, sans-serif;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 5px;
            max-width: 300px;
        }
        #legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            color: white;
            font-family: Arial, sans-serif;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 5px;
        }
        select {
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 5px;
            border: 1px solid white;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div id="controls">
        <div class="slider-container">
            <label for="timeSpeed">Time Speed (Earth days/second):</label>
            <input type="range" id="timeSpeed" min="0" max="50" step="1" value="1">
            <span id="timeSpeedValue">1</span>
        </div>
        <div class="dropdown-container">
            <label for="objectSelect">Focus on object:</label>
            <select id="objectSelect">
                <option value="">Select an object...</option>
                <optgroup label="Sun">
                    <option value="Sun">Sun</option>
                </optgroup>
                <optgroup label="Inner Planets & Moons">
                    <option value="Mercury">Mercury</option>
                    <option value="Venus">Venus</option>
                    <option value="Earth">Earth</option>
                    <option value="Earth-Moon">Earth's Moon</option>
                    <option value="Mars">Mars</option>
                    <option value="Mars-Phobos">Phobos</option>
                    <option value="Mars-Deimos">Deimos</option>
                </optgroup>
                <optgroup label="Outer Planets & Major Moons">
                    <option value="Jupiter">Jupiter</option>
                    <option value="Jupiter-Io">Io</option>
                    <option value="Jupiter-Europa">Europa</option>
                    <option value="Jupiter-Ganymede">Ganymede</option>
                    <option value="Jupiter-Callisto">Callisto</option>
                    <option value="Saturn">Saturn</option>
                    <option value="Saturn-Titan">Titan</option>
                    <option value="Saturn-Enceladus">Enceladus</option>
                    <option value="Uranus">Uranus</option>
                    <option value="Uranus-Titania">Titania</option>
                    <option value="Neptune">Neptune</option>
                    <option value="Neptune-Triton">Triton</option>
                </optgroup>
                <optgroup label="Dwarf Planets">
                    <option value="Pluto">Pluto</option>
                    <option value="Ceres">Ceres</option>
                    <option value="Eris">Eris</option>
                    <option value="Haumea">Haumea</option>
                    <option value="Haumea-Hiiaka">Hi'iaka (Haumea's Moon)</option>
                    <option value="Haumea-Namaka">Namaka (Haumea's Moon)</option>
                    <option value="Makemake">Makemake</option>
                    <option value="Makemake-MK2">MK 2 (Makemake's Moon)</option>
                </optgroup>
            </select>
        </div>
    </div>
    <div id="planetInfo">Click on a celestial body to see its information</div>
    <div id="legend">
        Sun: Yellow<br>
        Inner Planets: Blue Orbits<br>
        Outer Planets: Gold Orbits<br>
        Asteroid Belt: Gray Points<br>
        Dwarf Planets: White Orbits<br>
        Moons: Gray Orbits
    </div>
    <script>
    <script>
    // Add these scaling functions first
    function getScaledDistance(au) {
        return 20 * Math.log(au * 50 + 1);
    }

    function getScaledSize(diameter) {
        // diameter in km
        return 0.8 * Math.log(diameter/100 + 1);
    }
   
    // Initialize Three.js scene
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 50000);
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // Initial camera setup
    camera.position.set(150, 75, 150);
    camera.lookAt(0, 0, 0);

    // Lighting
    const ambientLight = new THREE.AmbientLight(0x333333);
    scene.add(ambientLight);
    
    const sunLight = new THREE.PointLight(0xffffff, 2, 1000);
    scene.add(sunLight);

    // Create Sun
    const sunGeometry = new THREE.SphereGeometry(getScaledSize(1392700), 32, 32);
    const sunMaterial = new THREE.MeshBasicMaterial({
        color: 0xffff00,
        emissive: 0xffff00,
        emissiveIntensity: 1
    });
    const sun = new THREE.Mesh(sunGeometry, sunMaterial);
    sun.userData = { 
        name: "Sun",
        info: "Sun - Our Star<br>• Distance: 0 AU<br>• Diameter: 1,392,700 km<br>• Surface Temperature: 5,500°C<br>• Age: ~4.6 billion years<br>• Mass: 333,000 Earth masses<br>• Composition: 73% Hydrogen, 25% Helium<br>• Fun facts: Contains 99.86% of the solar system's mass; produces light through nuclear fusion; completes one rotation every ~27 Earth days at its equator"
    };
    scene.add(sun);
// Create asteroid belt
function createAsteroidBelt() {
    const asteroidCount = 2000;
    const minRadius = getScaledDistance(2.2);  // Inner edge of asteroid belt
    const maxRadius = getScaledDistance(3.2);  // Outer edge of asteroid belt
    const asteroidSystem = new THREE.Object3D();
    const asteroids = [];

    for (let i = 0; i < asteroidCount; i++) {
        // Random radius and angle for each asteroid
        const radius = Math.random() * (maxRadius - minRadius) + minRadius;
        const theta = Math.random() * Math.PI * 2;
        const y = (Math.random() - 0.5) * 2; // Gives some vertical spread
        
        // Create individual asteroid
        const asteroidGeometry = new THREE.SphereGeometry(0.1, 4, 4);
        const shade = Math.random() * 0.5 + 0.5;
        const asteroidMaterial = new THREE.MeshPhongMaterial({
            color: new THREE.Color(shade, shade, shade),
            emissive: new THREE.Color(shade/8, shade/8, shade/8)
        });
        const asteroid = new THREE.Mesh(asteroidGeometry, asteroidMaterial);
        
        // Set initial position
        asteroid.position.set(
            Math.cos(theta) * radius,
            y,
            Math.sin(theta) * radius
        );
        
        // Store orbital properties
        asteroid.userData = {
            radius: radius,
            orbitSpeed: (1 / radius) * 0.5, // Closer asteroids move faster
            orbitAngle: theta
        };
        
        asteroidSystem.add(asteroid);
        asteroids.push(asteroid);
    }

    scene.add(asteroidSystem);
    return asteroids;
}

// Create the belt and store asteroid references
const asteroids = createAsteroidBelt();
    // Define all celestial data including planets, moons, and dwarf planets
    Mercury: {
        radius: getScaledSize(4879),
        distance: getScaledDistance(0.387),
        period: 88,
        color: 0x8c8c8c,
        orbitColor: 0x4169e1,
        info: "Mercury - Innermost Planet<br>• Distance: 0.387 AU<br>• Diameter: 4,879 km<br>• Fun fact: Despite being closest to Sun, not the hottest"
    },
    Venus: {
        radius: getScaledSize(12104),
        distance: getScaledDistance(0.723),
        period: 225,
        color: 0xffd700,
        orbitColor: 0x4169e1,
        info: "Venus - The Hot Planet<br>• Distance: 0.723 AU<br>• Diameter: 12,104 km<br>• Fun fact: Rotates backwards"
    },
    Earth: {
        radius: getScaledSize(12742),
        distance: getScaledDistance(1.0),
        period: 365,
        color: 0x4169e1,
        orbitColor: 0x4169e1,
        info: "Earth - Our Home<br>• Distance: 1.0 AU<br>• Diameter: 12,742 km<br>• Fun fact: Only known planet with life",
        moons: {
            "Earth-Moon": {
                radius: getScaledSize(3475),
                distance: getScaledDistance(0.002573),
                period: 27.3,
                color: 0xcccccc,
                orbitColor: 0x666666,
                info: "Moon - Earth's Only Natural Satellite<br>• Distance: 384,400 km<br>• Diameter: 3,475 km<br>• Fun fact: Same side always faces Earth"
            }
        }
    },
    Mars: {
        radius: getScaledSize(6779),
        distance: getScaledDistance(1.524),
        period: 687,
        color: 0xff4500,
        orbitColor: 0x4169e1,
        info: "Mars - The Red Planet<br>• Distance: 1.524 AU<br>• Diameter: 6,779 km<br>• Fun fact: Has the largest known volcano",
        moons: {
            "Mars-Phobos": {
                radius: getScaledSize(22.2),
                distance: getScaledDistance(0.00006),
                period: 0.3,
                color: 0x8b4513,
                orbitColor: 0x666666,
                info: "Phobos - Mars's Larger Moon<br>• Distance: 9,377 km<br>• Diameter: 22.2 km<br>• Fun fact: Getting closer to Mars each year"
            },
            "Mars-Deimos": {
                radius: getScaledSize(12.6),
                distance: getScaledDistance(0.00015),
                period: 1.2,
                color: 0x8b4513,
                orbitColor: 0x666666,
                info: "Deimos - Mars's Smaller Moon<br>• Distance: 23,460 km<br>• Diameter: 12.6 km<br>• Fun fact: Takes 30 hours to orbit Mars"
            }
        }
    },
    Jupiter: {
        radius: getScaledSize(139820),
        distance: getScaledDistance(5.203),
        period: 4333,
        color: 0xffa500,
        orbitColor: 0xffd700,
        info: "Jupiter - The Giant<br>• Distance: 5.203 AU<br>• Diameter: 139,820 km<br>• Fun fact: Has a permanent storm larger than Earth",
        moons: {
            "Jupiter-Io": {
                radius: getScaledSize(3642),
                distance: getScaledDistance(0.002819),
                period: 1.8,
                color: 0xfffacd,
                orbitColor: 0x666666,
                info: "Io - Most Volcanic Moon<br>• Distance: 421,700 km<br>• Diameter: 3,642 km<br>• Fun fact: Has over 400 active volcanoes"
            },
            "Jupiter-Europa": {
                radius: getScaledSize(3122),
                distance: getScaledDistance(0.004485),
                period: 3.5,
                color: 0xf5f5dc,
                orbitColor: 0x666666,
                info: "Europa - Ice Moon<br>• Distance: 670,900 km<br>• Diameter: 3,122 km<br>• Fun fact: Has a subsurface ocean"
            },
            "Jupiter-Ganymede": {
                radius: getScaledSize(5268),
                distance: getScaledDistance(0.007155),
                period: 7.2,
                color: 0xd3d3d3,
                orbitColor: 0x666666,
                info: "Ganymede - Largest Moon<br>• Distance: 1,070,400 km<br>• Diameter: 5,268 km<br>• Fun fact: Larger than Mercury"
            },
            "Jupiter-Callisto": {
                radius: getScaledSize(4821),
                distance: getScaledDistance(0.012585),
                period: 16.7,
                color: 0x808080,
                orbitColor: 0x666666,
                info: "Callisto - Heavily Cratered Moon<br>• Distance: 1,882,700 km<br>• Diameter: 4,821 km<br>• Fun fact: Most heavily cratered object in solar system"
            }
        }
    },
    Saturn: {
        radius: getScaledSize(116460),
        distance: getScaledDistance(9.537),
        period: 10759,
        color: 0xffd700,
        orbitColor: 0xffd700,
        info: "Saturn - The Ringed Planet<br>• Distance: 9.537 AU<br>• Diameter: 116,460 km<br>• Fun fact: Could float in a giant bathtub",
        moons: {
            "Saturn-Titan": {
                radius: getScaledSize(5150),
                distance: getScaledDistance(0.008168),
                period: 15.9,
                color: 0xd2b48c,
                orbitColor: 0x666666,
                info: "Titan - Largest Saturn Moon<br>• Distance: 1,221,870 km<br>• Diameter: 5,150 km<br>• Fun fact: Only moon with thick atmosphere"
            },
            "Saturn-Enceladus": {
                radius: getScaledSize(504),
                distance: getScaledDistance(0.001591),
                period: 1.4,
                color: 0xfffafa,
                orbitColor: 0x666666,
                info: "Enceladus - Ice Geyser Moon<br>• Distance: 238,020 km<br>• Diameter: 504 km<br>• Fun fact: Has ice geysers at south pole"
            }
        }
    },
    Uranus: {
        radius: getScaledSize(50724),
        distance: getScaledDistance(19.191),
        period: 30687,
        color: 0x40e0d0,
        orbitColor: 0xffd700,
        info: "Uranus - The Sideways Planet<br>• Distance: 19.191 AU<br>• Diameter: 50,724 km<br>• Fun fact: Rotates on its side",
        moons: {
            "Uranus-Titania": {
                radius: getScaledSize(1578),
                distance: getScaledDistance(0.002914),
                period: 8.7,
                color: 0xa9a9a9,
                orbitColor: 0x666666,
                info: "Titania - Largest Uranus Moon<br>• Distance: 435,910 km<br>• Diameter: 1,578 km<br>• Fun fact: Has a system of canyons"
            }
        }
    },
    Neptune: {
        radius: getScaledSize(49244),
        distance: getScaledDistance(30.069),
        period: 60190,
        color: 0x0000ff,
        orbitColor: 0xffd700,
        info: "Neptune - The Windy Planet<br>• Distance: 30.069 AU<br>• Diameter: 49,244 km<br>• Fun fact: Fastest winds in the solar system",
        moons: {
            "Neptune-Triton": {
                radius: getScaledSize(2707),
                distance: getScaledDistance(0.002371),
                period: -5.9,
                color: 0xe6e6fa,
                orbitColor: 0x666666,
                info: "Triton - Backwards Moon<br>• Distance: 354,760 km<br>• Diameter: 2,707 km<br>• Fun fact: Orbits backwards around Neptune"
            }
        }
    },
    Pluto: {
        radius: getScaledSize(2377),
        distance: getScaledDistance(39.482),
        period: 90560,
        color: 0xd3d3d3,
        orbitColor: 0xffffff,
        info: "Pluto - Dwarf Planet<br>• Distance: 39.482 AU<br>• Diameter: 2,377 km<br>• Fun fact: Was classified as a planet until 2006"
    },
    Ceres: {
        radius: getScaledSize(940),
        distance: getScaledDistance(2.766),
        period: 1682,
        color: 0x8b8989,
        orbitColor: 0xffffff,
        info: "Ceres - Largest Asteroid<br>• Distance: 2.766 AU<br>• Diameter: 940 km<br>• Fun fact: Contains 25% of all asteroid belt mass"
    },
    Eris: {
        radius: getScaledSize(2326),
        distance: getScaledDistance(67.781),
        period: 203830,
        color: 0xe8e8e8,
        orbitColor: 0xffffff,
        info: "Eris - Most Massive Dwarf Planet<br>• Distance: 67.781 AU<br>• Diameter: 2,326 km<br>• Fun fact: Has a moon named Dysnomia"
    },
    Haumea: {
        radius: getScaledSize(1632),
        distance: getScaledDistance(43.335),
        period: 104025,
        color: 0xe0e0e0,
        orbitColor: 0xffffff,
        info: "Haumea - Fast Spinning Dwarf Planet<br>• Distance: 43.335 AU<br>• Diameter: ~1,632 km<br>• Fun fact: Rotates once every 4 hours",
        moons: {
            "Haumea-Hiiaka": {
                radius: getScaledSize(310),
                distance: getScaledDistance(0.00033),
                period: 49.1,
                color: 0xcccccc,
                orbitColor: 0x666666,
                info: "Hi'iaka - Haumea's Larger Moon<br>• Distance: ~49,880 km<br>• Diameter: ~310 km"
            },
            "Haumea-Namaka": {
                radius: getScaledSize(170),
                distance: getScaledDistance(0.00026),
                period: 34.7,
                color: 0xcccccc,
                orbitColor: 0x666666,
                info: "Namaka - Haumea's Smaller Moon<br>• Distance: ~39,300 km<br>• Diameter: ~170 km"
            }
        }
    },
    Makemake: {
        radius: getScaledSize(1430),
        distance: getScaledDistance(45.791),
        period: 111690,
        color: 0xf0e68c,
        orbitColor: 0xffffff,
        info: "Makemake - Bright Dwarf Planet<br>• Distance: 45.791 AU<br>• Diameter: ~1,430 km",
        moons: {
            "Makemake-MK2": {
                radius: getScaledSize(175),
                distance: getScaledDistance(0.00014),
                period: 12.4,
                color: 0xcccccc,
                orbitColor: 0x666666,
                info: "S/2015 (136472) 1 - Makemake's Moon<br>• Distance: ~21,000 km<br>• Diameter: ~175 km"
                }
            }
        }
    };
    const allObjects = {};
    const orbits = {};
    
    // Create celestial bodies and their moons
    function createCelestialBody(name, data, parentObject = null) {
        const geometry = new THREE.SphereGeometry(data.radius, 32, 32);
        let material;
        if (name === 'Jupiter' || name === 'Saturn' || name === 'Uranus' || name === 'Neptune') {
            // Gas giants get special texture
            material = new THREE.MeshPhongMaterial({
                map: createGasGiantTexture(data.color),
                emissive: data.color,
                emissiveIntensity: 0.2,
                bumpScale: 0.05,
                shininess: 15
            });
        } else if (name === 'Sun') {
            // Sun gets special glowing material
            material = new THREE.MeshBasicMaterial({
                color: data.color,
                emissive: data.color,
                emissiveIntensity: 1
            });
        } else {
            // Rocky bodies
            material = new THREE.MeshPhongMaterial({
                map: createPlanetTexture(4, 0.7, `#${data.color.toString(16).padStart(6, '0')}`),
                emissive: data.color,
                emissiveIntensity: 0.2,
                bumpScale: 0.05,
                shininess: 20
            });
        }
        const body = new THREE.Mesh(geometry, material);

        if (name === 'Saturn') {
            // Add rings
            const ringGeometry = new THREE.RingGeometry(5, 8, 64);
            const ringMaterial = new THREE.MeshPhongMaterial({
                color: 0xb7b7b7,
                side: THREE.DoubleSide,
                transparent: true,
                opacity: 0.6,
                map: createPlanetTexture(2, 0.9, '#b7b7b7')
            });
            const rings = new THREE.Mesh(ringGeometry, ringMaterial);
            rings.rotation.x = Math.PI / 2;
            body.add(rings);
        }    
        
        body.userData = { name: name, info: data.info };

        // Create orbit
        if (parentObject === null) {
            // Orbit around the sun
            const orbitGeometry = new THREE.BufferGeometry();
            const orbitPoints = [];
            const segments = 128;
    
            // Adding orbital eccentricity
            const eccentricities = {
                Mercury: 0.206,
                Venus: 0.007,
                Earth: 0.017,
                Mars: 0.093,
                Jupiter: 0.048,
                Saturn: 0.054,
                Uranus: 0.047,
                Neptune: 0.009,
                Pluto: 0.248,
                Ceres: 0.076,
                Eris: 0.442,
                Haumea: 0.195,
                Makemake: 0.159
            };

            const e = eccentricities[name] || 0;
            const a = data.distance;  // semi-major axis
            const b = a * Math.sqrt(1 - e*e);  // semi-minor axis
    
            for (let i = 0; i <= segments; i++) {
                const theta = (i / segments) * Math.PI * 2;
                const r = (a * (1 - e*e)) / (1 + e * Math.cos(theta));
                orbitPoints.push(
                    r * Math.cos(theta),
                    0,
                    r * Math.sin(theta)
                );
            }
            
            orbitGeometry.setAttribute('position', new THREE.Float32BufferAttribute(orbitPoints, 3));
            const orbitMaterial = new THREE.LineBasicMaterial({ color: data.orbitColor });
            const orbit = new THREE.Line(orbitGeometry, orbitMaterial);
            scene.add(orbit);
            orbits[name] = orbit;
            scene.add(body);
        } else {
            // Create moon orbit relative to parent
            const moonOrbit = new THREE.Object3D();
            parentObject.add(moonOrbit);
            moonOrbit.add(body);
            
            const orbitGeometry = new THREE.BufferGeometry();
            const orbitPoints = [];
            const segments = 128;
            
            for (let i = 0; i <= segments; i++) {
                const theta = (i / segments) * Math.PI * 2;
                orbitPoints.push(
                    Math.cos(theta) * data.distance,
                    0,
                    Math.sin(theta) * data.distance
                );
            }
            
            orbitGeometry.setAttribute('position', new THREE.Float32BufferAttribute(orbitPoints, 3));
            const orbitMaterial = new THREE.LineBasicMaterial({ color: data.orbitColor });
            const orbit = new THREE.Line(orbitGeometry, orbitMaterial);
            parentObject.add(orbit);
            orbits[name] = orbit;
        }

        allObjects[name] = body;

        // Create moons if they exist
        if (data.moons) {
            Object.entries(data.moons).forEach(([moonName, moonData]) => {
                createCelestialBody(moonName, moonData, body);
            });
        }

        return body;
    }

    // Create all celestial bodies
    Object.entries(celestialData).forEach(([name, data]) => {
        createCelestialBody(name, data);
    });

    // Animation variables
    let time = 0;
    const timeSpeedSlider = document.getElementById('timeSpeed');
    const timeSpeedValue = document.getElementById('timeSpeedValue');
    const planetInfo = document.getElementById('planetInfo');

    // Camera controls
    let isDragging = false;
    let previousMousePosition = { x: 0, y: 0 };
    let cameraAngle = { x: 0, y: 0 };
    let cameraDistance = 200;
    // Mouse event listeners
    document.addEventListener('mousedown', (e) => {
        isDragging = true;
        previousMousePosition = { x: e.clientX, y: e.clientY };
    });

    document.addEventListener('mousemove', (e) => {
        if (!isDragging) return;

        const deltaMove = {
            x: e.clientX - previousMousePosition.x,
            y: e.clientY - previousMousePosition.y
        };

        cameraAngle.x += deltaMove.y * 0.01;
        cameraAngle.y += deltaMove.x * 0.01;

        cameraAngle.x = Math.max(-Math.PI/2, Math.min(Math.PI/2, cameraAngle.x));
        updateCameraPosition();
        previousMousePosition = { x: e.clientX, y: e.clientY };
    });

    document.addEventListener('mouseup', () => isDragging = false);

    document.addEventListener('wheel', (e) => {
        cameraDistance = Math.max(50, Math.min(1000, cameraDistance + e.deltaY * 0.5));
        updateCameraPosition();
    });

    function updateCameraPosition() {
        const x = cameraDistance * Math.cos(cameraAngle.x) * Math.sin(cameraAngle.y);
        const y = cameraDistance * Math.sin(cameraAngle.x);
        const z = cameraDistance * Math.cos(cameraAngle.x) * Math.cos(cameraAngle.y);

        camera.position.set(x, y, z);
        camera.lookAt(0, 0, 0);
    }

    // Animation loop
    function animate() {
        requestAnimationFrame(animate);

        Object.entries(celestialData).forEach(([name, data]) => {
            if (name in allObjects) {
                const object = allObjects[name];
                const angle = (time / data.period) * Math.PI * 2;
                
                if (!object.parent || object.parent.type !== "Object3D") {
                    // Planet orbiting the sun
                    object.position.x = Math.cos(angle) * data.distance;
                    object.position.z = Math.sin(angle) * data.distance;
                }
                
                object.rotation.y += 0.01;

                // Update moons if they exist
                if (data.moons) {
                    Object.entries(data.moons).forEach(([moonName, moonData]) => {
                        const moonAngle = (time / moonData.period) * Math.PI * 2;
                        const moonObject = allObjects[moonName];
                        if (moonObject && moonObject.parent) {
                            moonObject.position.x = Math.cos(moonAngle) * moonData.distance;
                            moonObject.position.z = Math.sin(moonAngle) * moonData.distance;
                        }
                    });
                }
            }
        });

        // Update asteroid positions
        asteroids.forEach(asteroid => {
            const speed = asteroid.userData.orbitSpeed * timeSpeedSlider.value;
            asteroid.userData.orbitAngle += speed;
            
            asteroid.position.x = Math.cos(asteroid.userData.orbitAngle) * asteroid.userData.radius;
            asteroid.position.z = Math.sin(asteroid.userData.orbitAngle) * asteroid.userData.radius;
            
            // Add slight wobble to y position
            asteroid.position.y += Math.sin(time * 0.001) * 0.001;
        });
    
        time += parseFloat(timeSpeedSlider.value);
        renderer.render(scene, camera);
    }

    // Start animation
    animate();

    // Handle window resizing
    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });

    // Add click detection
    const raycaster = new THREE.Raycaster();
    const mouse = new THREE.Vector2();

    document.addEventListener('click', (event) => {
        mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
        mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

        raycaster.setFromCamera(mouse, camera);
        
        // Add sun to the list of objects to check
        const allObjectsToCheck = [sun, ...Object.values(allObjects)];
        
        // Check for intersections with objects
        const objectIntersects = raycaster.intersectObjects(allObjectsToCheck);
        // Check for intersections with orbits
        const orbitIntersects = raycaster.intersectObjects(Object.values(orbits));

        if (objectIntersects.length > 0) {
            // Clicked on a celestial body (including sun)
            const object = objectIntersects[0].object;
            planetInfo.innerHTML = object.userData.info;
        } else if (orbitIntersects.length > 0) {
            // Clicked on an orbit
            const orbit = orbitIntersects[0].object;
            // Find the corresponding celestial body
            const bodyName = Object.keys(orbits).find(key => orbits[key] === orbit);
            if (bodyName) {
                let body;
                // Check if it's a moon
                const [parentBody, moonName] = bodyName.split('-');
                if (moonName) {
                    body = celestialData[parentBody].moons[bodyName];
                } else {
                    body = celestialData[bodyName];
                }
                if (body && body.info) {
                    planetInfo.innerHTML = body.info;
                }
            }
        }
    });

    // Dropdown handler
    document.getElementById('objectSelect').addEventListener('change', (e) => {
        const selectedObject = e.target.value;
        if (selectedObject === "Sun") {
            camera.position.set(200, 100, 200);
            camera.lookAt(0, 0, 0);
        } else if (selectedObject && selectedObject in allObjects) {
            const object = allObjects[selectedObject];
            const position = new THREE.Vector3();
            object.getWorldPosition(position);
            camera.position.set(
                position.x + 30,
                position.y + 30,
                position.z + 30
            );
            camera.lookAt(position);
        }
    });

    // Handle time speed slider
    timeSpeedSlider.addEventListener('input', (e) => {
        timeSpeedValue.textContent = e.target.value;
    });
</script>
</body>
</html>
